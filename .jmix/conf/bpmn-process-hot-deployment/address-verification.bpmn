<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:jmix="http://jmix.io/schema/bpm/bpmn" xmlns:flowable="http://flowable.org/bpmn" xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="http://www.flowable.org/processdef" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd">
  <process id="address-verification" name="Address verification" isExecutable="true">
    <startEvent id="startEvent1">
      <extensionElements>
        <jmix:processVariables />
      </extensionElements>
      <outgoing>Flow_18lp63d</outgoing>
    </startEvent>
    <exclusiveGateway id="Gateway_09onbq5">
      <incoming>Flow_1745bhs</incoming>
      <incoming>Flow_0e40gcw</incoming>
      <outgoing>Flow_0hfsb41</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="Flow_18lp63d" sourceRef="startEvent1" targetRef="Activity_0j7p8cm" />
    <sequenceFlow id="Flow_0hfsb41" sourceRef="Gateway_09onbq5" targetRef="Gateway_1na4awx" />
    <sequenceFlow id="Flow_0p0vqld" sourceRef="Activity_1m3q7ji" targetRef="Gateway_0dmoin6" />
    <eventBasedGateway id="Gateway_0dmoin6">
      <incoming>Flow_0p0vqld</incoming>
      <outgoing>Flow_1m3fqkx</outgoing>
      <outgoing>Flow_1p0md2k</outgoing>
      <outgoing>Flow_1i0dgdd</outgoing>
    </eventBasedGateway>
    <intermediateCatchEvent id="Event_1eif3b8">
      <incoming>Flow_1m3fqkx</incoming>
      <outgoing>Flow_02p1irt</outgoing>
      <timerEventDefinition id="TimerEventDefinition_1mgh79s">
        <timeDuration xsi:type="tFormalExpression">PT50S</timeDuration>
      </timerEventDefinition>
    </intermediateCatchEvent>
    <sequenceFlow id="Flow_1m3fqkx" sourceRef="Gateway_0dmoin6" targetRef="Event_1eif3b8" />
    <intermediateCatchEvent id="Event_OK" name="OK">
      <incoming>Flow_1p0md2k</incoming>
      <outgoing>Flow_0oypf24</outgoing>
      <messageEventDefinition id="MessageEventDefinition_16wc568" messageRef="address-OK" />
    </intermediateCatchEvent>
    <sequenceFlow id="Flow_1p0md2k" sourceRef="Gateway_0dmoin6" targetRef="Event_OK" />
    <intermediateCatchEvent id="Event_Fake" name="Fake">
      <incoming>Flow_1i0dgdd</incoming>
      <outgoing>Flow_1sfvqy4</outgoing>
      <messageEventDefinition id="MessageEventDefinition_1vzapwj" messageRef="fake-address" />
    </intermediateCatchEvent>
    <sequenceFlow id="Flow_1i0dgdd" sourceRef="Gateway_0dmoin6" targetRef="Event_Fake" />
    <sequenceFlow id="Flow_1sfvqy4" sourceRef="Event_Fake" targetRef="Activity_08f6y02" />
    <endEvent id="Event_0ja16pi">
      <incoming>Flow_0oypf24</incoming>
    </endEvent>
    <sequenceFlow id="Flow_0oypf24" sourceRef="Event_OK" targetRef="Event_0ja16pi" />
    <sequenceFlow id="Flow_02p1irt" sourceRef="Event_1eif3b8" targetRef="Activity_0osmd8v" />
    <serviceTask id="Activity_1m3q7ji" name="Send request to Nominatim" flowable:expression="${ord_AddressVerificator.verify(address,execution)}" jmix:taskType="springBean" jmix:beanName="ord_AddressVerificator">
      <extensionElements>
        <jmix:springBean beanName="ord_AddressVerificator" methodName="verify">
          <jmix:methodParam name="address" type="java.lang.String" isVariable="true">address</jmix:methodParam>
          <jmix:methodParam name="execution" type="org.flowable.engine.delegate.DelegateExecution" isVariable="true">execution</jmix:methodParam>
        </jmix:springBean>
      </extensionElements>
      <incoming>Flow_0nztrf6</incoming>
      <outgoing>Flow_0p0vqld</outgoing>
    </serviceTask>
    <sequenceFlow id="Flow_1745bhs" sourceRef="Activity_0osmd8v" targetRef="Gateway_09onbq5" />
    <scriptTask id="Activity_0osmd8v" name="counter++" scriptFormat="groovy">
      <incoming>Flow_02p1irt</incoming>
      <outgoing>Flow_1745bhs</outgoing>
      <script>// Ensure counter is initialized
def counter = execution.getVariable("counter") ?: 0

// Increment the counter
execution.setVariable("counter", counter + 1)

// Print the updated counter value
println "Counter: ${counter + 1}"
</script>
    </scriptTask>
    <exclusiveGateway id="Gateway_1na4awx" default="Flow_0nztrf6">
      <incoming>Flow_0hfsb41</incoming>
      <outgoing>Flow_0nztrf6</outgoing>
      <outgoing>Flow_0ygm417</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="Flow_0nztrf6" sourceRef="Gateway_1na4awx" targetRef="Activity_1m3q7ji" />
    <sequenceFlow id="Flow_0ygm417" name="counter == 3" sourceRef="Gateway_1na4awx" targetRef="Activity_0xgqj6e">
      <extensionElements>
        <jmix:conditionDetails conditionSource="expression" />
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression">${counter == 3}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="Flow_0e40gcw" sourceRef="Activity_0j7p8cm" targetRef="Gateway_09onbq5" />
    <scriptTask id="Activity_0j7p8cm" name="counter = 0" scriptFormat="groovy">
      <incoming>Flow_18lp63d</incoming>
      <outgoing>Flow_0e40gcw</outgoing>
      <script>execution.setVariable("counter", 0)</script>
    </scriptTask>
    <endEvent id="Event_1snsy68">
      <incoming>Flow_1hjdrwk</incoming>
    </endEvent>
    <sequenceFlow id="Flow_1hjdrwk" sourceRef="Activity_0xgqj6e" targetRef="Event_1snsy68" />
    <serviceTask id="Activity_0xgqj6e" name="Throw BPMN error" flowable:expression="${ord_ErrorService.throwBpmnError(&#39;500&#39;,&#39;Service do not respond&#39;)}" jmix:taskType="springBean" jmix:beanName="ord_ErrorService">
      <extensionElements>
        <jmix:springBean beanName="ord_ErrorService" methodName="throwBpmnError">
          <jmix:methodParam name="code" type="java.lang.String" isVariable="false">500</jmix:methodParam>
          <jmix:methodParam name="message" type="java.lang.String" isVariable="false">Service do not respond</jmix:methodParam>
        </jmix:springBean>
      </extensionElements>
      <incoming>Flow_0ygm417</incoming>
      <outgoing>Flow_1hjdrwk</outgoing>
    </serviceTask>
    <endEvent id="Event_080izh6">
      <incoming>Flow_1riez5w</incoming>
    </endEvent>
    <sequenceFlow id="Flow_1riez5w" sourceRef="Activity_08f6y02" targetRef="Event_080izh6" />
    <serviceTask id="Activity_08f6y02" name="Throw BPMN error" flowable:expression="${ord_ErrorService.throwBpmnError(&#39;400&#39;,&#39;Fake address&#39;)}" jmix:taskType="springBean" jmix:beanName="ord_ErrorService">
      <extensionElements>
        <jmix:springBean beanName="ord_ErrorService" methodName="throwBpmnError">
          <jmix:methodParam name="code" type="java.lang.String" isVariable="false">400</jmix:methodParam>
          <jmix:methodParam name="message" type="java.lang.String" isVariable="false">Fake address</jmix:methodParam>
        </jmix:springBean>
      </extensionElements>
      <incoming>Flow_1sfvqy4</incoming>
      <outgoing>Flow_1riez5w</outgoing>
    </serviceTask>
  </process>
  <message id="fake-address" name="Fake address" />
  <error id="fake-address-error" name="Fake address error" errorCode="400" />
  <error id="service-do-not-respond" name="Service do not respond" errorCode="500" />
  <message id="address-OK" name="Address OK" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_process">
    <bpmndi:BPMNPlane id="BPMNPlane_process" bpmnElement="address-verification">
      <bpmndi:BPMNShape id="BPMNShape_startEvent1" bpmnElement="startEvent1">
        <omgdc:Bounds x="12" y="150" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_09onbq5_di" bpmnElement="Gateway_09onbq5" isMarkerVisible="true">
        <omgdc:Bounds x="245" y="143" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0hsfiqf_di" bpmnElement="Gateway_0dmoin6">
        <omgdc:Bounds x="605" y="143" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1eif3b8_di" bpmnElement="Event_1eif3b8">
        <omgdc:Bounds x="702" y="52" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_14icsu2_di" bpmnElement="Event_OK">
        <omgdc:Bounds x="702" y="150" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="712" y="193" width="16" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1rodpg4_di" bpmnElement="Event_Fake">
        <omgdc:Bounds x="702" y="262" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="708" y="305" width="25" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0ja16pi_di" bpmnElement="Event_0ja16pi">
        <omgdc:Bounds x="802" y="150" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1fbjeib_di" bpmnElement="Activity_1m3q7ji">
        <omgdc:Bounds x="420" y="128" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1fgsxvr_di" bpmnElement="Activity_0osmd8v">
        <omgdc:Bounds x="420" y="-40" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1na4awx_di" bpmnElement="Gateway_1na4awx" isMarkerVisible="true">
        <omgdc:Bounds x="325" y="143" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_19bosjn_di" bpmnElement="Activity_0j7p8cm">
        <omgdc:Bounds x="100" y="128" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0xu0yjp_di" bpmnElement="Event_1snsy68">
        <omgdc:Bounds x="562" y="262" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1507ite_di" bpmnElement="Activity_0xgqj6e">
        <omgdc:Bounds x="420" y="240" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_05t6nog_di" bpmnElement="Event_080izh6">
        <omgdc:Bounds x="912" y="262" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1245h0b_di" bpmnElement="Activity_08f6y02">
        <omgdc:Bounds x="780" y="240" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_18lp63d_di" bpmnElement="Flow_18lp63d">
        <omgdi:waypoint x="48" y="168" />
        <omgdi:waypoint x="100" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0hfsb41_di" bpmnElement="Flow_0hfsb41">
        <omgdi:waypoint x="295" y="168" />
        <omgdi:waypoint x="325" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0p0vqld_di" bpmnElement="Flow_0p0vqld">
        <omgdi:waypoint x="520" y="168" />
        <omgdi:waypoint x="605" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1m3fqkx_di" bpmnElement="Flow_1m3fqkx">
        <omgdi:waypoint x="630" y="143" />
        <omgdi:waypoint x="630" y="70" />
        <omgdi:waypoint x="702" y="70" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1p0md2k_di" bpmnElement="Flow_1p0md2k">
        <omgdi:waypoint x="655" y="168" />
        <omgdi:waypoint x="702" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1i0dgdd_di" bpmnElement="Flow_1i0dgdd">
        <omgdi:waypoint x="630" y="193" />
        <omgdi:waypoint x="630" y="280" />
        <omgdi:waypoint x="702" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1sfvqy4_di" bpmnElement="Flow_1sfvqy4">
        <omgdi:waypoint x="738" y="280" />
        <omgdi:waypoint x="780" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0oypf24_di" bpmnElement="Flow_0oypf24">
        <omgdi:waypoint x="738" y="168" />
        <omgdi:waypoint x="802" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_02p1irt_di" bpmnElement="Flow_02p1irt">
        <omgdi:waypoint x="720" y="52" />
        <omgdi:waypoint x="720" y="0" />
        <omgdi:waypoint x="520" y="0" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1745bhs_di" bpmnElement="Flow_1745bhs">
        <omgdi:waypoint x="420" y="0" />
        <omgdi:waypoint x="270" y="0" />
        <omgdi:waypoint x="270" y="143" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0nztrf6_di" bpmnElement="Flow_0nztrf6">
        <omgdi:waypoint x="375" y="168" />
        <omgdi:waypoint x="420" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ygm417_di" bpmnElement="Flow_0ygm417">
        <omgdi:waypoint x="350" y="193" />
        <omgdi:waypoint x="350" y="280" />
        <omgdi:waypoint x="420" y="280" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="279" y="258" width="62" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0e40gcw_di" bpmnElement="Flow_0e40gcw">
        <omgdi:waypoint x="200" y="168" />
        <omgdi:waypoint x="245" y="168" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1hjdrwk_di" bpmnElement="Flow_1hjdrwk">
        <omgdi:waypoint x="520" y="280" />
        <omgdi:waypoint x="562" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1riez5w_di" bpmnElement="Flow_1riez5w">
        <omgdi:waypoint x="880" y="280" />
        <omgdi:waypoint x="912" y="280" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
