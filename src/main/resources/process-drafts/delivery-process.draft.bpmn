<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:flowable="http://flowable.org/bpmn" xmlns:jmix="http://jmix.io/schema/bpm/bpmn" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="http://www.flowable.org/processdef" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd">
  <message id="start-delivery" name="Start delivery" />
  <collaboration id="Collaboration_0g1rg9y">
    <participant id="Participant_0jzequf" name="Delivery process" processRef="delivery-process" />
    <participant id="Participant_0zazzhg" name="Order processing" />
    <messageFlow id="Flow_02" sourceRef="Activity_00pks50" targetRef="Participant_0zazzhg" />
    <messageFlow id="Flow_01" sourceRef="Activity_15rm5jf" targetRef="Participant_0zazzhg" />
  </collaboration>
  <process id="delivery-process" name="Delivery process" isExecutable="true">
    <sequenceFlow id="Flow_1" sourceRef="startEvent1" targetRef="Activity_1dbfnym">
      <extensionElements>
        <jmix:conditionDetails conditionSource="expression" />
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="Flow_5" sourceRef="Activity_00pks50" targetRef="Event_1v5wbck">
      <extensionElements>
        <jmix:conditionDetails conditionSource="expression" />
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="Flow_3" sourceRef="Activity_15rm5jf" targetRef="Event_1lzvlg0">
      <extensionElements>
        <jmix:conditionDetails conditionSource="expression" />
      </extensionElements>
    </sequenceFlow>
    <serviceTask id="Activity_15rm5jf" name="Send message &#34;In delivery&#34;" flowable:async="true" flowable:expression="${ord_DeliveryService.sendMessage(orders_item, &#39;Order in delivery&#39;)}" jmix:taskType="${ord_DeliveryService.sendMessage(orders_item, &#39;Order in delivery&#39;)}" jmix:beanName="ord_DeliveryService" camunda:async="true">
      <extensionElements>
        <jmix:springBean beanName="ord_DeliveryService" methodName="sendMessage">
          <jmix:methodParam name="order" type="com.company.orderprocessing.entity.Order" isVariable="true">orders_item</jmix:methodParam>
          <jmix:methodParam name="messageName" type="java.lang.String" isVariable="false">Order in delivery</jmix:methodParam>
        </jmix:springBean>
      </extensionElements>
      <incoming>Flow_2</incoming>
      <outgoing>Flow_3</outgoing>
      <multiInstanceLoopCharacteristics isSequential="true" flowable:collection="orders" flowable:elementVariable="orders_item" jmix:collectionSource="processVariable" jmix:collectionValue="orders" />
    </serviceTask>
    <sequenceFlow id="Flow_2" sourceRef="Activity_1dbfnym" targetRef="Activity_15rm5jf">
      <extensionElements>
        <jmix:conditionDetails conditionSource="expression" />
      </extensionElements>
    </sequenceFlow>
    <serviceTask id="Activity_1dbfnym" name="Create delivery" flowable:async="true" flowable:expression="${ord_DeliveryService.createDelivery(orderIds, execution)}" flowable:resultVariable="orders" jmix:taskType="${ord_DeliveryService.createDelivery(orderIds, execution)}" jmix:beanName="ord_DeliveryService">
      <extensionElements>
        <jmix:springBean beanName="ord_DeliveryService" methodName="createDelivery">
          <jmix:methodParam name="orderIds" type="java.util.List" isVariable="true">orderIds</jmix:methodParam>
          <jmix:methodParam name="execution" type="org.flowable.engine.delegate.DelegateExecution" isVariable="true">execution</jmix:methodParam>
        </jmix:springBean>
      </extensionElements>
      <incoming>Flow_1</incoming>
      <outgoing>Flow_2</outgoing>
    </serviceTask>
    <startEvent id="startEvent1">
      <extensionElements>
        <jmix:formData type="no-form" />
      </extensionElements>
      <outgoing>Flow_1</outgoing>
      <messageEventDefinition id="MessageEventDefinition_0xlmsje" messageRef="start-delivery" />
    </startEvent>
    <sequenceFlow id="Flow_0chxxhs" sourceRef="Activity_06rvaog" targetRef="Activity_00pks50" />
    <sequenceFlow id="Flow_0r5nbd7" sourceRef="Event_1lzvlg0" targetRef="Activity_06rvaog" />
    <intermediateCatchEvent id="Event_1lzvlg0">
      <incoming>Flow_3</incoming>
      <outgoing>Flow_0r5nbd7</outgoing>
      <timerEventDefinition id="TimerEventDefinition_1lmsomp">
        <timeDuration xsi:type="tFormalExpression">PT15S</timeDuration>
      </timerEventDefinition>
    </intermediateCatchEvent>
    <serviceTask id="Activity_00pks50" name="Send message &#34;Delivered&#34;" flowable:async="true" flowable:expression="${ord_DeliveryService.sendMessage(orders_item, &#39;Order delivered&#39;)}" jmix:taskType="${ord_DeliveryService.sendMessage(orders_item, &#39;Order delivered&#39;)}" jmix:beanName="ord_DeliveryService" camunda:async="true">
      <extensionElements>
        <jmix:springBean beanName="ord_DeliveryService" methodName="sendMessage">
          <jmix:methodParam name="order" type="com.company.orderprocessing.entity.Order" isVariable="true">orders_item</jmix:methodParam>
          <jmix:methodParam name="messageName" type="java.lang.String" isVariable="false">Order delivered</jmix:methodParam>
        </jmix:springBean>
      </extensionElements>
      <incoming>Flow_0chxxhs</incoming>
      <outgoing>Flow_5</outgoing>
      <multiInstanceLoopCharacteristics isSequential="true" flowable:collection="orders" flowable:elementVariable="orders_item" jmix:collectionSource="processVariable" jmix:collectionValue="orders" />
    </serviceTask>
    <endEvent id="Event_1v5wbck">
      <incoming>Flow_5</incoming>
    </endEvent>
    <serviceTask id="Activity_06rvaog" name="Perform delivery" flowable:expression="${ord_DeliveryService.performDelivery(execution)}" jmix:taskType="${ord_DeliveryService.performDelivery(execution)}" jmix:beanName="ord_DeliveryService">
      <extensionElements>
        <jmix:springBean beanName="ord_DeliveryService" methodName="performDelivery">
          <jmix:methodParam name="execution" type="org.flowable.engine.delegate.DelegateExecution" isVariable="true">execution</jmix:methodParam>
        </jmix:springBean>
      </extensionElements>
      <incoming>Flow_0r5nbd7</incoming>
      <outgoing>Flow_0chxxhs</outgoing>
    </serviceTask>
    <textAnnotation id="TextAnnotation_0zoqv6h">
      <text>Start by Quartz</text>
    </textAnnotation>
    <association id="Association_14ekqzg" sourceRef="startEvent1" targetRef="TextAnnotation_0zoqv6h" />
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_process">
    <bpmndi:BPMNPlane id="BPMNPlane_process" bpmnElement="Collaboration_0g1rg9y">
      <bpmndi:BPMNShape id="Participant_0jzequf_di" bpmnElement="Participant_0jzequf" isHorizontal="true">
        <omgdc:Bounds x="140" y="80" width="920" height="319" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_09cec5v_di" bpmnElement="Activity_15rm5jf">
        <omgdc:Bounds x="460" y="210" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ttf8ia_di" bpmnElement="Activity_1dbfnym">
        <omgdc:Bounds x="310" y="210" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_19ssrpb_di" bpmnElement="startEvent1">
        <omgdc:Bounds x="232" y="232" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_13ucaf5_di" bpmnElement="Event_1lzvlg0">
        <omgdc:Bounds x="602" y="232" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0a70lxa_di" bpmnElement="Activity_00pks50">
        <omgdc:Bounds x="830" y="210" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1v5wbck_di" bpmnElement="Event_1v5wbck">
        <omgdc:Bounds x="982" y="232" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_11o5d5g_di" bpmnElement="Activity_06rvaog">
        <omgdc:Bounds x="680" y="210" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0zoqv6h_di" bpmnElement="TextAnnotation_0zoqv6h">
        <omgdc:Bounds x="210" y="160" width="140" height="26" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1ohq3pn_di" bpmnElement="Flow_1">
        <omgdi:waypoint x="268" y="250" />
        <omgdi:waypoint x="310" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_13goami_di" bpmnElement="Flow_5">
        <omgdi:waypoint x="930" y="250" />
        <omgdi:waypoint x="982" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0unfzh4_di" bpmnElement="Flow_3">
        <omgdi:waypoint x="560" y="250" />
        <omgdi:waypoint x="602" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1s9ng2p_di" bpmnElement="Flow_2">
        <omgdi:waypoint x="410" y="250" />
        <omgdi:waypoint x="460" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0chxxhs_di" bpmnElement="Flow_0chxxhs">
        <omgdi:waypoint x="780" y="250" />
        <omgdi:waypoint x="830" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0r5nbd7_di" bpmnElement="Flow_0r5nbd7">
        <omgdi:waypoint x="638" y="250" />
        <omgdi:waypoint x="680" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_14ekqzg_di" bpmnElement="Association_14ekqzg">
        <omgdi:waypoint x="256" y="233" />
        <omgdi:waypoint x="271" y="186" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Participant_1n0rcrg_di" bpmnElement="Participant_0zazzhg" isHorizontal="true">
        <omgdc:Bounds x="460" y="470" width="480" height="60" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_00s4c1i_di" bpmnElement="Flow_02">
        <omgdi:waypoint x="880" y="290" />
        <omgdi:waypoint x="880" y="470" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_00bry14_di" bpmnElement="Flow_01">
        <omgdi:waypoint x="510" y="290" />
        <omgdi:waypoint x="510" y="470" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
